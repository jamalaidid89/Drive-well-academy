<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DW Assistant - Drive-Well Academy AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --dark: #0f172a; --dark-soft: #1e293b; --dark-card: #273449; --red: #dc2626; --red-dark: #b91c1c; --text: #ffffff; --text-muted: #94a3b8; --text-light: #cbd5e1; --green: #22c55e; --blue: #3b82f6; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, var(--dark) 0%, var(--dark-soft) 100%); min-height: 100vh; color: var(--text); }
        .chat-container { max-width: 900px; margin: 0 auto; height: 100vh; display: flex; flex-direction: column; }
        .chat-header { background: rgba(15, 23, 42, 0.95); padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 15px; }
        .bot-avatar { width: 50px; height: 50px; background: linear-gradient(135deg, var(--red) 0%, var(--red-dark) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; }
        .header-info h1 { font-size: 20px; }
        .header-info h1 span { color: var(--red); }
        .header-info p { color: var(--text-muted); font-size: 13px; }
        .header-right { margin-left: auto; display: flex; gap: 15px; align-items: center; }
        .status-badge { display: flex; align-items: center; gap: 6px; background: rgba(34, 197, 94, 0.15); padding: 6px 12px; border-radius: 20px; font-size: 12px; color: var(--green); }
        .status-dot { width: 8px; height: 8px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; }
        .home-btn { background: rgba(255,255,255,0.1); border: none; color: var(--text-muted); padding: 8px 15px; border-radius: 20px; font-size: 13px; text-decoration: none; display: flex; align-items: center; gap: 6px; }
        .home-btn:hover { background: var(--red); color: white; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .messages-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .message { display: flex; gap: 12px; max-width: 85%; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.user { align-self: flex-end; flex-direction: row-reverse; }
        .message-avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; color: white; flex-shrink: 0; }
        .message.bot .message-avatar { background: linear-gradient(135deg, var(--red) 0%, var(--red-dark) 100%); }
        .message.user .message-avatar { background: var(--blue); }
        .message-content { background: var(--dark-card); padding: 14px 18px; border-radius: 18px; line-height: 1.6; }
        .message.user .message-content { background: var(--red); border-bottom-right-radius: 4px; }
        .message.bot .message-content { border-bottom-left-radius: 4px; }
        .message-time { font-size: 11px; color: var(--text-muted); margin-top: 6px; }
        .typing-indicator { display: flex; gap: 4px; padding: 15px 18px; background: var(--dark-card); border-radius: 18px; width: fit-content; }
        .typing-indicator span { width: 8px; height: 8px; background: var(--text-muted); border-radius: 50%; animation: typing 1.4s infinite; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-8px); } }
        .quick-actions { padding: 15px 20px; display: flex; gap: 10px; overflow-x: auto; border-top: 1px solid rgba(255,255,255,0.05); background: rgba(15, 23, 42, 0.5); }
        .quick-action { background: var(--dark-card); border: 1px solid rgba(255,255,255,0.1); color: var(--text-light); padding: 10px 16px; border-radius: 20px; font-size: 13px; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 8px; }
        .quick-action:hover { background: var(--red); border-color: var(--red); color: white; }
        .input-container { padding: 20px; background: rgba(15, 23, 42, 0.95); border-top: 1px solid rgba(255,255,255,0.1); }
        .input-wrapper { display: flex; gap: 12px; align-items: flex-end; }
        .input-box { flex: 1; background: var(--dark-card); border-radius: 25px; padding: 5px; display: flex; align-items: center; border: 1px solid rgba(255,255,255,0.1); }
        .input-box:focus-within { border-color: var(--red); }
        .input-box textarea { flex: 1; background: transparent; border: none; color: var(--text); padding: 12px 15px; font-size: 15px; resize: none; max-height: 120px; min-height: 24px; font-family: inherit; }
        .input-box textarea::placeholder { color: var(--text-muted); }
        .input-box textarea:focus { outline: none; }
        .send-btn { width: 50px; height: 50px; border-radius: 50%; border: none; background: linear-gradient(135deg, var(--red) 0%, var(--red-dark) 100%); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .send-btn:hover { transform: scale(1.05); }
        .send-btn:disabled { opacity: 0.5; }
        .welcome-screen { text-align: center; padding: 40px 20px; }
        .welcome-avatar { width: 80px; height: 80px; background: linear-gradient(135deg, var(--red) 0%, var(--red-dark) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 36px; margin: 0 auto 20px; color: white; }
        .welcome-screen h2 { font-size: 28px; margin-bottom: 10px; }
        .welcome-screen h2 span { color: var(--red); }
        .welcome-screen > p { color: var(--text-muted); max-width: 500px; margin: 0 auto 30px; }
        .feature-cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 600px; margin: 0 auto; }
        .feature-card { background: var(--dark-card); padding: 20px; border-radius: 12px; text-align: left; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .feature-card:hover { border-color: var(--red); transform: translateY(-3px); }
        .feature-card i { font-size: 24px; color: var(--red); margin-bottom: 12px; }
        .feature-card h4 { margin-bottom: 6px; font-size: 15px; }
        .feature-card p { font-size: 13px; color: var(--text-muted); margin: 0; }
        @media (max-width: 768px) { .feature-cards { grid-template-columns: 1fr; } .message { max-width: 90%; } .home-btn span { display: none; } }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="bot-avatar"><i class="fas fa-car"></i></div>
            <div class="header-info"><h1>DW <span>Assistant</span></h1><p>Drive-Well Academy AI</p></div>
            <div class="header-right">
                <div class="status-badge"><div class="status-dot"></div> Online</div>
                <a href="index.html" class="home-btn"><i class="fas fa-home"></i> <span>Back</span></a>
            </div>
        </div>
        <div class="messages-container" id="messagesContainer">
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-avatar"><i class="fas fa-car"></i></div>
                <h2>Welcome to <span>DW Assistant</span></h2>
                <p>I can help with theory tests, driving tips, and booking enquiries!</p>
                <div class="feature-cards">
                    <div class="feature-card" onclick="askQuestion('Give me a theory test question')"><i class="fas fa-graduation-cap"></i><h4>Theory Test</h4><p>Practice questions</p></div>
                    <div class="feature-card" onclick="askQuestion('How many lessons do I need?')"><i class="fas fa-car"></i><h4>Lessons</h4><p>Get an estimate</p></div>
                    <div class="feature-card" onclick="askQuestion('What are your prices?')"><i class="fas fa-pound-sign"></i><h4>Prices</h4><p>View rates</p></div>
                    <div class="feature-card" onclick="askQuestion('How do I book?')"><i class="fas fa-calendar-check"></i><h4>Book</h4><p>Schedule a lesson</p></div>
                </div>
            </div>
        </div>
        <div class="quick-actions">
            <button class="quick-action" onclick="askQuestion('Theory test question')"><i class="fas fa-question-circle"></i> Theory</button>
            <button class="quick-action" onclick="askQuestion('How many lessons?')"><i class="fas fa-car"></i> Lessons</button>
            <button class="quick-action" onclick="askQuestion('Parallel parking')"><i class="fas fa-parking"></i> Parking</button>
            <button class="quick-action" onclick="askQuestion('Test tips')"><i class="fas fa-check-circle"></i> Tips</button>
        </div>
        <div class="input-container">
            <div class="input-wrapper">
                <div class="input-box"><textarea id="userInput" placeholder="Ask me anything..." rows="1" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage();}"></textarea></div>
                <button class="send-btn" onclick="sendMessage()" id="sendBtn"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>
    <script>
        // API key is stored securely on the server - don't put it here!
        const SYSTEM_PROMPT = 'You are DW Assistant for Drive-Well Academy, Bristol UK. Phone: 07514 377 171. Email: info@drive-well-academy.com. Coverage: BS1-BS16. Offer manual and automatic. Standard lessons 2hrs, test day 2.5hrs. Average learner needs 40-50hrs. Cancellation: 48hrs free, 24-48hrs 50%, under 24hrs full. Franchise: 50 pounds/week. Be friendly, use emojis, create theory questions when asked.';
        let conversationHistory = [];
        let isProcessing = false;
        function askQuestion(q) { document.getElementById('userInput').value = q; sendMessage(); }
        function addMessage(content, isUser) {
            const ws = document.getElementById('welcomeScreen'); if (ws) ws.style.display = 'none';
            const c = document.getElementById('messagesContainer');
            const d = document.createElement('div');
            d.className = 'message ' + (isUser ? 'user' : 'bot');
            d.innerHTML = '<div class="message-avatar"><i class="fas ' + (isUser ? 'fa-user' : 'fa-car') + '"></i></div><div><div class="message-content">' + content.replace(/\n/g,'<br>') + '</div><div class="message-time">' + new Date().toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'}) + '</div></div>';
            c.appendChild(d); c.scrollTop = c.scrollHeight;
        }
        function addTyping() {
            const c = document.getElementById('messagesContainer');
            const d = document.createElement('div'); d.className = 'message bot'; d.id = 'typing';
            d.innerHTML = '<div class="message-avatar"><i class="fas fa-car"></i></div><div class="typing-indicator"><span></span><span></span><span></span></div>';
            c.appendChild(d); c.scrollTop = c.scrollHeight;
        }
        function removeTyping() { const t = document.getElementById('typing'); if (t) t.remove(); }
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message || isProcessing) return;
            isProcessing = true;
            document.getElementById('sendBtn').disabled = true;
            input.value = '';
            addMessage(message, true);
            conversationHistory.push({ role: 'user', content: message });
            addTyping();
            try {
                // Call secure serverless function (API key stored on server)
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: conversationHistory, systemPrompt: SYSTEM_PROMPT })
                });
                if (!response.ok) {
                    throw new Error('API request failed: ' + response.status);
                }
                const data = await response.json();
                removeTyping();
                if (data.content && data.content[0]) {
                    addMessage(data.content[0].text, false);
                    conversationHistory.push({ role: 'assistant', content: data.content[0].text });
                } else { addMessage('Sorry, please try again or call 07514 377 171.', false); }
            } catch (e) { 
                console.error('Error:', e);
                removeTyping(); 
                addMessage('Connection error. Make sure API key is set in Vercel. Call 07514 377 171 if issue persists.', false); 
            }
            isProcessing = false;
            document.getElementById('sendBtn').disabled = false;
            input.focus();
        }
    </script>
</body>
</html>
